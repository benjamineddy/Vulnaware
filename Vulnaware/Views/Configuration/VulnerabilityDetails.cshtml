@model Vulnaware.Models.UserCveConfiguration
@inject UserManager<ApplicationUser> UserManager
@{
    ViewData["Title"] = "VulnerabilityDetailsView";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="page-wrapper">
    <br />
    <div class="row">
        <!-- Coloured cve id -->
        @if (Model.Cve.BaseScore < 3)
        {
            <div class="col-lg-4">
                <div class="panel panel-green">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-1">
                                <i class="fa fa-exclamation-circle fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">@Html.DisplayFor(model => model.Cve.GivenID)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        @if (Model.Cve.BaseScore >= 3 && Model.Cve.BaseScore < 7)
        {
            <div class="col-lg-4">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-1">
                                <i class="fa fa-exclamation-circle fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">@Html.DisplayFor(model => model.Cve.GivenID)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        @if (Model.Cve.BaseScore > 7 && Model.Cve.BaseScore <= 9)
        {
            <div class="col-lg-4">
                <div class="panel panel-yellow">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-1">
                                <i class="fa fa-exclamation-circle fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">@Html.DisplayFor(model => model.Cve.GivenID)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        @if (Model.Cve.BaseScore > 9)
        {
            <div class="col-lg-4">
                <div class="panel panel-red">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-1">
                                <i class="fa fa-exclamation-circle fa-5x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="huge">@Html.DisplayFor(model => model.Cve.GivenID)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        <!-- Customised notes and status form -->
        <form method="post" action="@Url.Action("UpdateUserVulnerability", "Configuration")">
            <div class="col-lg-2">
                @Html.AntiForgeryToken()
                <input type="hidden" name="configurationId" value="@Model.ConfigurationID" />
                <input type="hidden" name="ProductID" value="@Model.ProductID" />
                <input type="hidden" name="CveID" value="@Model.CveID" />
                <div class="form-group">
                    <b>Status</b>
                    <br />
                    <select name="StatusId">
                        @foreach (var item in ViewBag.StatusObjectList)
                        {
                            if (item.StatusID == Model.StatusID)
                            {
                                <option selected="selected" value="@item.StatusID">@item.StatusName</option>
                            }
                            else
                            {
                                <option value="@item.StatusID">@item.StatusName</option>
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label asp-for="Notes" class="control-label"></label>
                    <textarea asp-for="Notes" class="form-control" rows="3"></textarea>
                    <span asp-validation-for="Notes" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <input type="submit" value="Save" class="btn btn-default" />
                </div>
            </div>
        </form>
    </div>
    <div class="row">
        <!-- Product details panel -->
        <div class="col-lg-6">
            <div class="panel panel-green">
                <div class="panel-heading">
                    Product Details
                </div>
                <div class="panel-body">
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Product.Vendor):</b>
                    @Html.DisplayFor(modelItem => Model.Product.Vendor)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Product.ProductName):</b>
                    @Html.DisplayFor(modelItem => Model.Product.ProductName)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Product.Version):</b>
                    @Html.DisplayFor(modelItem => Model.Product.Version)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Product.ProductUpdate):</b>
                    @Html.DisplayFor(modelItem => Model.Product.ProductUpdate)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Product.Edition):</b>
                    @Html.DisplayFor(modelItem => Model.Product.Edition)
                </div>
            </div>
            <!-- Vulnerability details panel -->
            <div class="panel panel-green">
                <div class="panel-heading">
                    Vulnerability Details
                </div>
                <div class="panel-body">
                    <b>@Html.DisplayNameFor(modelItem => Model.Cve.PublishedDate):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.PublishedDate)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => Model.Cve.LastModifiedDate):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.LastModifiedDate)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => Model.Cve.Description):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.Description)
                </div>
            </div>
            <!-- Vulnerability metrics panel -->
            <div class="panel panel-green">
                <div class="panel-heading">
                    Vulnerability Metrics
                </div>
                <div class="panel-body">
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Cve.BaseScore):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.BaseScore)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Cve.AccessComplexity):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.AccessComplexity)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Cve.AccessVector):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.AccessVector)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Cve.Authentication):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.Authentication)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Cve.AvailabilityImpact):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.AvailabilityImpact)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Cve.ConfidentialityImpact):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.ConfidentialityImpact)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Cve.IntegrityImpact):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.IntegrityImpact)
                    <br />
                    <b>@Html.DisplayNameFor(modelItem => modelItem.Cve.VectorString):</b>
                    @Html.DisplayFor(modelItem => Model.Cve.VectorString)
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <!-- Reference list datatable -->
            <div class="panel panel-green">
                <div class="panel-heading">
                    Reference List
                </div>
                <div class="panel-body">
                    <b><font color="red">NAVIGATING TO THESE REFERENCES IS DONE AT YOUR OWN RISK.</font></b>
                    <table style="width:100%;" class="table table-striped table-bordered table-hover" id="dataTables-references">
                        <thead>
                            <tr>
                                <th>Reference</th>
                                <th>Link</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var referenceItem in Model.Cve.References)
                            {
                                <tr>
                                    <td>@Html.DisplayFor(modelItem => referenceItem.Url)</td>
                                    <td>
                                        <a class="btn btn-primary" target="_blank"
                                           href="@Html.DisplayFor(modelItem => referenceItem.Url)">View</a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <!-- Instructions panel -->
            <div class="panel panel-green">
                <div class="panel-heading">
                    How do CVSS Metrics work?
                </div>
                <div class="panel-body">
                    <b>Common Vulnerability Scoring System</b>
                    <br />
                    The Common Vulnerability Scoring System (CVSS) is a normalised method to score a vulnerability on a number of metrics.
                    A average score, or "base score" is an average based on the scores of the other metrics.
                    <br /><br />
                    <div class="row">
                        <div class="col-lg-6">
                            <h4>Exploitability Metrics</h4>
                            <b>Attack Vector:</b>
                            The proximity required to exploit the vulnerability.
                            <br />
                            <b>Access Complexity:</b>
                            How difficult a vulnerabiltiy is to exploit.
                            <br />
                            <b>Authentication:</b>
                            Whether hightened privileges are required.
                        </div>
                        <div class="col-lg-6">
                            <h4>Impact Metrics</h4>
                            <b>Confidentiality:</b>
                            The impact severity on system/data confidentiality.
                            <br />
                            <b>Integrity Impact:</b>
                            The impact severity on system/data integrity.
                            <br />
                            <b>Availability Impact:</b>
                            The impact severity on the ongoing avialability of the system/data.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @section scripts{
        <script>
            $(document).ready(function () {
                $('#dataTables-references').DataTable({
                    rensponsive: true,
                    scrollX: true,
                });
            });
        </script>
    }
</div>

