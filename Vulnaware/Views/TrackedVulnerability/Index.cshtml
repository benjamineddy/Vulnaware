@model Vulnaware.Models.ApplicationUser
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="page-wrapper">
    <br />
    <h2>Tracked Vulnerabilities</h2>
    <br />
    <div class="row">
        <!-- Tracked vulnerabilites datatable -->
        <div class="col-lg-12">
            <div class="panel panel-green">
                <div class="panel-heading">
                </div>
                <div class="panel-body">
                    <table style="width:100%;" class="table table-striped table-bordered table-hover" id="dataTables-trackedCves">
                        <thead>
                            <tr>
                                <th>CVE ID</th>
                                <th>Base Score</th>
                                <th>Published Date</th>
                                <th>Access Complexity</th>
                                <th>Access Vector</th>
                                <th>Authentication</th>
                                <th>Availability Impact</th>
                                <th>Confidentiality Impact</th>
                                <th>Integrity Impact</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var trackedCveItem in Model.TrackedCves)
                            {
                                <tr>
                                    <td>@Html.DisplayFor(modelItem => trackedCveItem.Cve.GivenID)</td>
                                    <td>
                                        @if (trackedCveItem.Cve.BaseScore <= 3)
                                        {
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-success" role="progressbar" style="width:25%">
                                                    @Html.DisplayFor(modelItem => trackedCveItem.Cve.BaseScore)
                                                </div>
                                            </div>
                                        }
                                        @if (trackedCveItem.Cve.BaseScore > 3
                                              && trackedCveItem.Cve.BaseScore <= 6)
                                        {
                                            <div class="progress">
                                                <div class="progress-bar" role="progressbar" style="width:50%">
                                                    @Html.DisplayFor(modelItem => trackedCveItem.Cve.BaseScore)
                                                </div>
                                            </div>
                                        }
                                        @if (trackedCveItem.Cve.BaseScore > 6
                                              && trackedCveItem.Cve.BaseScore <= 9)
                                        {
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-warning" role="progressbar" style="width:75%">
                                                    @Html.DisplayFor(modelItem => trackedCveItem.Cve.BaseScore)
                                                </div>
                                            </div>

                                        }
                                        @if (trackedCveItem.Cve.BaseScore > 9)
                                        {
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-danger" role="progressbar" style="width:100%">
                                                    @Html.DisplayFor(modelItem => trackedCveItem.Cve.BaseScore)
                                                </div>
                                            </div>

                                        }
                                    </td>
                                    <td>@Html.DisplayFor(modelItem => trackedCveItem.Cve.PublishedDate)</td>
                                    <td>@Html.DisplayFor(modelItem => trackedCveItem.Cve.AccessComplexity)</td>
                                    <td>@Html.DisplayFor(modelItem => trackedCveItem.Cve.AccessVector)</td>
                                    <td>@Html.DisplayFor(modelItem => trackedCveItem.Cve.Authentication)</td>
                                    <td>@Html.DisplayFor(modelItem => trackedCveItem.Cve.AvailabilityImpact)</td>
                                    <td>@Html.DisplayFor(modelItem => trackedCveItem.Cve.ConfidentialityImpact)</td>
                                    <td>@Html.DisplayFor(modelItem => trackedCveItem.Cve.IntegrityImpact)</td>
                                    <td>
                                        <a class="btn btn-info" asp-controller="TrackedVulnerability" asp-action="Details"
                                           asp-route-cveID="@trackedCveItem.CveID">
                                            Details
                                        </a>
                                        <div class="btn btn-primary" id="Untrack" onclick=Untrack(@trackedCveItem.CveID);>Untrack</div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div id="action-configuration-div" style="display:none">
                    <img style="display:block; margin-left:auto; margin-right:auto" src="~/images/loader.gif" alt="Actioning..." />
                </div>
                <br />
            </div>
        </div>
    </div>
    @section scripts{
        <script>
            $(document).ready(function () {
                $('#dataTables-trackedCves').DataTable({
                    scrollX: true,
                    columnDefs:
                    [
                        {
                            "targets": [9],
                            "orderable": false
                        }
                    ],
                });
            });
        </script>
        <script type="text/javascript">
            function showHide() {
                var oimageDiv = document.getElementById('action-configuration-div')
                oimageDiv.style.display = (oimageDiv.style.display == 'none') ? 'inline' : 'none'
            }
        </script>
        <script>
            function Untrack(cveID)
            {
                $.ajax({
                    url: '@Url.Action("RemoveTrackedVulnerability")',
                    type: "POST",
                    data: { cveId: cveID },
                    success: function (result) {
                        location.reload();
                    },
                    error: function (data) {
                        alert("Something went wrong, please try again.");
                    }
                })
            }
        </script>
    }
</div>

